## 算法流程

### 1. 图像预处理与初始化 (Image Preprocessing)
* **作用**：将输入图像转换为模型可处理的张量格式，并建立优化起点。
* **实现细节**：
    * **等比缩放**：保持长宽比缩放图像，确保在显存允许范围内处理，同时避免特征拉伸。
    * **数值归一化**：将像素值从 [0, 255] 映射至 [0, 1] 范围，符合预训练 VGG 模型的输入分布。
    * **噪声初始化**：在内容图基础上叠加少量高斯噪声。相比纯随机噪声，这种方式能保留原始内容的边缘信息，使收敛更迅速且结果更清晰。

### 2. 特征提取模块 (Feature Extraction)
* **作用**：利用预训练网络将像素信号转换为语义特征，实现内容与风格的解耦。
* **实现细节**：
    * **骨干网络**：采用预训练的 **VGG16**。调用 `stop_grad()` 冻结所有权重，仅将其作为固定的特征提取器。
    * **多层映射**：通过索引定义内容层（如 `conv4_2`）和多个风格层（从 `conv1_1` 到 `conv5_1`）。
    * **特征捕获**：一次前向传播同时获取用于结构对比的深层特征和用于纹理对比的多尺度特征。

### 3. 内容与风格度量 (Loss Metrics)
* **作用**：定义数学指标来量化生成图像与目标图像之间的视觉差异。
* **实现细节**：
    * **内容损失**：计算生成图与内容图在深层特征图上的 **MSE Loss**，确保物体的空间结构得以保留。
    * **风格损失 (Gram Matrix)**：通过计算特征通道间的内积得到 Gram 矩阵。它消除了空间位置信息，仅提取颜色分布与纹理模式。
    * **层级加权**：对不同深度的风格层赋予不同的衰减权重（底层权重最高，侧重颜色笔触；高层权重较低，侧重抽象图案）。



### 4. 优化与约束循环 (Optimization Loop)
* **作用**：通过迭代不断修正像素值，寻找总损失函数的全局最优解。
* **实现细节**：
    * **学习变量**：将生成图声明为可求导张量（`requires_grad = True`），此时梯度直接作用于像素而非网络参数。
    * **参数更新**：使用 **Adam** 优化器根据组合损失函数 $L_{total} = \alpha L_{content} + \beta L_{style}$ 自动调整图像像素。
    * **投影约束 (Clipping)**：每轮迭代后执行 `clamp(0, 1)`。由于梯度更新可能导致像素值越界，必须强制截断以保证图像显示的合法性。

### 5. 后处理与输出 (Post-processing)
* **作用**：将抽象的张量数据还原为可直观预览的图像文件。
* **实现细节**：
    * **维度变换**：利用 `permute` 将张量从通道优先格式 `(C, H, W)` 转换回图像标准的 `(H, W, C)`。
    * **逆归一化**：将数值从 [0, 1] 还原至 [0, 255]，并转换为 `uint8` 编码。
    * **图像渲染**：通过 PIL 库将处理后的数组保存为最终的艺术化图片。

## 根据损失函数曲线分析算法的收敛性

### 1. 总体收敛趋势分析

通过观察损失函数曲线（`output1_loss_curve.png`），可以分析算法的收敛特性：

* **总损失曲线特征**：
    * **初期快速下降**：在迭代的前 200-500 次，总损失呈现快速下降趋势。这反映了算法从初始噪声图像快速向目标风格迁移的过程。
    * **中期平稳收敛**：在 500-1500 次迭代区间，损失下降速度逐渐减缓，曲线趋于平缓。这表明算法进入了精细调整阶段，在内容保留和风格迁移之间寻找平衡点。
    * **后期稳定**：在 1500-2000 次迭代后，损失值基本稳定在较低水平，波动幅度很小，说明算法已接近收敛状态。

### 2. 内容损失与风格损失的收敛差异

* **内容损失收敛特性**：
    * 内容损失（Content Loss）通常收敛较快，因为其权重相对较小（$\alpha = 2000$），且深层特征（`conv4_2`）主要捕获空间结构信息，相对稳定。
    * 曲线呈现**单调递减**趋势，说明生成图像的结构信息逐步接近内容图，空间布局得到有效保留。

* **风格损失收敛特性**：
    * 风格损失（Style Loss）收敛相对较慢，因为其权重很大（$\beta = 5 \times 10^9$），且涉及多层 Gram 矩阵的匹配。
    * 曲线可能呈现**震荡下降**模式，这是由于风格迁移需要在多个尺度上同时匹配纹理模式，优化过程更为复杂。
    * 不同层的风格损失收敛速度不同：低层（`conv1_1`, `conv2_1`）捕获的颜色和细节纹理收敛较快；高层（`conv4_1`, `conv5_1`）捕获的抽象模式收敛较慢。

## 改变内容损失函数和风格损失函数的权重比值
在output1.jpg基础上提高与降低内容/风格的权重比值，得到output1-h与output1-l两个图像，可以看出比值越大，越接近原内容，比值越小越接近风格图。


## 图片变化过程
见视频